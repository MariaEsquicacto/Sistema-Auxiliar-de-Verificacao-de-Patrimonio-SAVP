<!DOCTYPE html>
<html lang="pt-br">

<head>
       
    <meta charset="UTF-8">
       
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
       
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
       
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
       
    <link rel="stylesheet" href="../css/cadastrar_ambientes.css?V2.0">
        <title>Cadastrar Ambientes</title>
</head>

<body>
        <header>
                    </header>

        <main>
                <div class="escrita">
                        <i class="bi bi-arrow-left" onclick="Voltar()"></i>
                        <h1>Cadastrar Ambientes</h1>
                    </div>

                <div class="conteiner">
                        <form id="formAmbiente" class="register-form">
                               
                                <div class="form-group">
                                        <label for="nome">Nome da sala:</label>
                                        <input type="text" id="nome" name="ambiente_nome" class="form-control"
                        placeholder="Ex: Laboratório de Usinagem">
                                    </div>

                                <div class="form-group">
                                        <label for="categoria">Categoria:</label>
                                        <select id="categoria" name="categoria" class="form-control">
                                                <option value="" disabled selected>Selecione uma categoria</option>
                                                <option value="eletroeletronica">Eletroeletrônica</option>
                                                <option value="oficina">Oficina</option>
                                                <option value="quimica">Química</option>
                                                <option value="t.i">T.I.</option>
                                                <option value="panificacao">Panificação</option>
                                                <option value="metalmecanica">Metalmecânica</option>
                                            </select>
                                    </div>

                                <div class="form-group">
                                        <label for="localizacao">Código:</label>
                                        <input type="text" id="localizacao" name="localizacao" class="form-control"
                        placeholder="Ex: 4911359">
                                    </div>

                                    <button type="submit" class="btn">Cadastrar</button>
                            </form>
                       
                    </div>
                 
            </main>

       
    <script>
        document.getElementById("formAmbiente").addEventListener("submit", async function (e) {
            e.preventDefault();

            // 1. Pega o token de autenticação
            const token = localStorage.getItem("token");

            if (!token) {
                alert("❌ Usuário não autenticado. Faça login novamente.");
                window.location.href = "login.html"; // Redireciona para login
                return;
            }

            const data = {
                ambiente_nome: document.getElementById("nome").value,
                categoria: document.getElementById("categoria").value,
                localizacao: document.getElementById("localizacao").value,
                ambiente_del: "ativo"
            };

            try {
                const response = await fetch("../../back-end/Post/Post_ambientes.php", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        // ESSENCIAL: Envia o token para autenticar a permissão
                        "Authorization": `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                // ⚠️ Se o status for 403, o PHP negou a permissão.
                if (response.status === 403) {
                    const errorResult = await response.json();
                    alert(`❌ Acesso Negado: ${errorResult.message}`);
                    return;
                }

                const result = await response.json();

                if (result.status === "success") {
                    alert("✅ " + result.message);
                    document.getElementById("formAmbiente").reset(); // limpa o formulário
                } else {
                    alert("❌ " + result.message);
                }
            } catch (error) {
                alert("⚠️ Erro na requisição: " + error.message);
            }
        });
        function Voltar() {
            window.location.href = 'home_admin.html'
        }
    </script>
</body>

</html>