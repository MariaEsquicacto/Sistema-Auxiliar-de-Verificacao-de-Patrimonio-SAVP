<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/relatorio.css">
    <link rel="stylesheet" href="../css/relatorio_excel.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>


    <title>Relatório</title>
</head>

<body>
    <header>
        <div class="header-colaborador">
            <div class="menu"><button class="hamburguer"><i class="bi bi-list"></i></button></div>
            <div class="logo"><img src="../assets/logo_senai.png" alt="logo-senai"></div>
            <div class="notificacao"><i class="bi bi-bell"></i></div>
        </div>
    </header>

    <main class="conteudo-relatorio">
        <div class="titulo-relatorio">
            <a href="relatorio.html" class="voltar"><i class="fa-solid fa-arrow-left"></i></a>
            <h1>Relatório PDF</h1>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ID_SETOR</th>
                        <th>NOME</th>
                        <th>DESCRICAO</th>
                        <th>CODIGO</th>
                        <th>STATUS</th>
                        <th>ANEXO</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>1</td>
                        <td>Computador</td>
                        <td>Monitor Dell</td>
                        <td class="ok">1015978</td>
                        <td><i class="fa-solid fa-circle-check verde"></i></td>
                        <td><i class="fa-solid fa-paperclip"></i></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>1</td>
                        <td>Impressora</td>
                        <td>Impressora Dell</td>
                        <td class="aviso">1015978</td>
                        <td><i class="fa-solid fa-triangle-exclamation amarelo"></i></td>
                        <td><i class="fa-solid fa-paperclip"></i></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>2</td>
                        <td>Mesa</td>
                        <td>Mesa do professor</td>
                        <td class="erro">1015978</td>
                        <td><i class="fa-solid fa-circle-xmark vermelho"></i></td>
                        <td><i class="fa-solid fa-paperclip"></i></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="botoes-relatorio">
            <button id="btn-baixar" class="btn btn-primary">Baixar PDF</button>
        </div>
    </main>

    <script>
        document.getElementById('btn-baixar').addEventListener('click', function () {
            const { jsPDF } = window.jspdf;

            // gera nome do arquivo com data/hora
            const now = new Date();
            const pad = n => n.toString().padStart(2, '0');
            const dateStr = now.getFullYear() + pad(now.getMonth() + 1) + pad(now.getDate()) + '_' +
                pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds());
            const filename = `relatorio_${dateStr}.pdf`;

            const doc = new jsPDF({ orientation: 'landscape' });

            // título centralizado
            const pageWidth = doc.internal.pageSize.getWidth();
            doc.setFontSize(18);
            doc.text('Relatório de Patrimônio', pageWidth / 2, 15, { align: 'center' });

            // --- monta os dados da tabela ---
            const body = [];
            document.querySelectorAll('table tbody tr').forEach(tr => {
                const row = [];
                tr.querySelectorAll('td').forEach((td, idx) => {
                    // converte ícones para texto
                    const icon = td.querySelector('i');
                    if (icon) {
                        const cls = icon.className;
                        if (cls.includes('fa-circle-check')) row.push('Ativo');
                        else if (cls.includes('fa-triangle-exclamation')) row.push('Atenção');
                        else if (cls.includes('fa-circle-xmark')) row.push('Inativo');
                        else if (cls.includes('fa-paperclip')) row.push('Sim');
                        else row.push('');
                    } else {
                        row.push(td.textContent.trim());
                    }
                });
                body.push(row);
            });

            const head = [[
                'ID', 'ID_SETOR', 'NOME', 'DESCRIÇÃO', 'CÓDIGO', 'STATUS', 'ANEXO'
            ]];

            // cria tabela no PDF
            doc.autoTable({
                head: head,
                body: body,
                startY: 25,
                styles: { fontSize: 10 },
                headStyles: { fillColor: [0, 102, 204], textColor: 255 }
            });

            doc.save(filename);
        });
    </script>


</body>

</html>